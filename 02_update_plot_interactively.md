# Interactive plot 
+ Get shape of selected by Lasso or Rect
+ Output path of drawed region

1. Install ipympl in conda env
   > pip install matplotlib ipympl

2. Code generated by Claude
%matplotlib widget
import numpy as np
import matplotlib.pyplot as plt
from matplotlib.widgets import LassoSelector, RectangleSelector
from matplotlib.path import Path

# Set interactive mode on
plt.ion()

# Sample data
np.random.seed(42)
x = np.random.rand(100)
y = np.random.rand(100)
colors = np.ones(len(x))  # Initial colors (all the same)

# Create the figure and axes
fig, ax = plt.subplots(figsize=(10, 8))
plt.subplots_adjust(bottom=0.2)  # Make room for buttons

# Initial scatter plot
scatter = ax.scatter(x, y, c=colors, s=100, alpha=0.6)
ax.set_title('Interactive Selection Demo - Use Tools Below', fontsize=14)

# Selected points indices
selected_points = []

# Function to update plot after selection
def update_scatter():
    global colors
    colors = np.ones(len(x))  # Reset colors
    if len(selected_points) > 0:  # Check length instead of array directly
        colors[selected_points] = 0.5  # Highlight selected points
    scatter.set_facecolors(plt.cm.viridis(colors))
    fig.canvas.draw_idle()

# Lasso selection callback
def onselect_lasso(verts):
    global selected_points
    path = Path(verts)
    selected_points = np.where(path.contains_points(np.vstack((x, y)).T))[0]
    update_scatter()
    
    # Get the coordinates of selected points
    selected_coords = [(x[i], y[i]) for i in selected_points]
    
    # Store the lasso vertices (the trace)
    lasso_trace = np.array(verts)
    
    # Make the lasso trace available globally
    globals()['lasso_trace'] = lasso_trace
    
    # Display information about selected points and lasso trace
    selection_text = f'Selected {len(selected_points)} points'
    if len(selected_points) > 0:
        selection_text += f'\nSelected points available in: selected_coords'
    
    selection_info.set_text(selection_text)
    
    # Print info about the lasso trace
    print(f"Lasso trace contains {len(lasso_trace)} vertices")
    print(f"First few points of the lasso trace: {lasso_trace[:5]}")
    print("Complete lasso trace available in variable: lasso_trace")
    
    # Optional: Plot the lasso trace
    if hasattr(ax, 'lasso_trace_line'):
        ax.lasso_trace_line.remove()
    ax.lasso_trace_line = ax.plot(lasso_trace[:, 0], lasso_trace[:, 1], 'r-', lw=1.5, alpha=0.7)[0]
    fig.canvas.draw_idle()
    
    # Make the coordinates available globally
    globals()['selected_coords'] = selected_coords
    
    return lasso_trace, selected_coords

# Rectangle selection callback
def onselect_rectangle(eclick, erelease):
    global selected_points
    x0, y0 = eclick.xdata, eclick.ydata
    x1, y1 = erelease.xdata, erelease.ydata
    
    # Find points within the rectangle
    selected_points = np.where(
        (x >= min(x0, x1)) & (x <= max(x0, x1)) & 
        (y >= min(y0, y1)) & (y <= max(y0, y1))
    )[0]
    update_scatter()
    
    # Get the coordinates of selected points
    selected_coords = [(x[i], y[i]) for i in selected_points]
    
    # Display information about selected points
    selection_text = f'Selected {len(selected_points)} points'
    if len(selected_points) > 0:
        selection_text += f'\nSelected points are available in variable: selected_coords'
        # Print to console/output for easy access
        print(f"Selected {len(selected_points)} points:")
        print(f"selected_coords = {selected_coords}")
    
    selection_info.set_text(selection_text)
    
    # Make the coordinates available globally
    globals()['selected_coords'] = selected_coords
    
    return selected_coords

# Create a text element for displaying selection info
selection_info = ax.text(0.05, 0.05, '', transform=ax.transAxes,
                         bbox=dict(boxstyle="round,pad=0.5", fc="yellow", alpha=0.7))

# Create lasso selector
lasso = LassoSelector(
    ax, 
    onselect_lasso,
    props=dict(color='black', linewidth=2),
    useblit=True,
    button=1  # Left mouse button
)
lasso.set_active(False)  # Initially inactive

# Create rectangle selector with smoother appearance
rect_selector = RectangleSelector(
    ax,
    onselect_rectangle,
    useblit=True,
    button=1,  # Left mouse button
    minspanx=5, minspany=5,
    spancoords='pixels',
    interactive=True,
    props=dict(facecolor='blue', edgecolor='black', alpha=0.2, linewidth=2)
)
rect_selector.set_active(False)  # Initially inactive

# Function to reset selection
def reset_selection(event):
    global selected_points
    selected_points = []
    update_scatter()
    selection_info.set_text('')

# Add control buttons
ax_lasso = plt.axes([0.15, 0.05, 0.2, 0.075])
ax_rectangle = plt.axes([0.4, 0.05, 0.2, 0.075])
ax_reset = plt.axes([0.65, 0.05, 0.2, 0.075])

button_lasso = plt.Button(ax_lasso, 'Lasso Select')
button_rectangle = plt.Button(ax_rectangle, 'Rectangle Select')
button_reset = plt.Button(ax_reset, 'Reset Selection')

# Button click handlers
def activate_lasso(event):
    lasso.set_active(True)
    rect_selector.set_active(False)
    ax.set_title('Lasso Selection Mode - Click and drag to select points', fontsize=14)
    
def activate_rectangle(event):
    lasso.set_active(False)
    rect_selector.set_active(True)
    ax.set_title('Rectangle Selection Mode - Click and drag to select points', fontsize=14)

button_lasso.on_clicked(activate_lasso)
button_rectangle.on_clicked(activate_rectangle)
button_reset.on_clicked(reset_selection)

plt.show()

3. Draw with lasso or rect
4. Output draing
> print(lasso_trace)
> 
> path = PathPatch(path, alpha = 0.2)
